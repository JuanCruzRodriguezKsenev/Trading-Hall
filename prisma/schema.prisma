// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../../src/app/generate/prisma"
}

datasource db {
  provider = "postgresql"
}

// 1. EL USUARIO
model User {
  id       String @id @default(cuid())
  username String @unique
  password String

  // RELACIONES ACTUALIZADAS:
  // 1. Mundos que este usuario CREÓ (Es el dueño)
  ownedWorlds  World[] @relation("WorldOwner")
  
  // 2. Mundos donde este usuario COLABORA (Es miembro invitado)
  memberWorlds World[] @relation("WorldMembers")
}

// 2. EL MUNDO
model World {
  id        String   @id @default(cuid())
  name      String   // Quitamos @unique aquí si quieres permitir nombres repetidos en distintos grupos
  createdAt DateTime @default(now())

  // --- NUEVO: SISTEMA DE INVITACIÓN ---
  inviteCode String @unique @default(cuid())

  // --- NUEVO: DUEÑO DEL MUNDO ---
  ownerId String
  owner   User   @relation("WorldOwner", fields: [ownerId], references: [id])

  // --- MIEMBROS COLABORADORES ---
  members User[] @relation("WorldMembers")

  // Los encantamientos de este mundo
  enchantments EnchantmentEntry[]
}

// 3. LA ENTRADA (Sin cambios, pero necesaria)
model EnchantmentEntry {
  id            String   @id @default(cuid())
  worldId       String
  world         World    @relation(fields: [worldId], references: [id])
  enchantmentId String
  level         Int      @default(0)
  price         Int      @default(0)
  villagerId    String?
  modifiedBy    String
  modifiedAt    DateTime @default(now())

  @@unique([worldId, enchantmentId])
}